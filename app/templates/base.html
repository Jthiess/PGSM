<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PGSM {% block title %}{% endblock %}</title>
    <!-- Theme loaded first; id allows theme.js to swap it without reload -->
    <link id="theme-link" rel="stylesheet" href="{{ url_for('static', filename='css/themes/theme-default.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pgsm.css') }}">
    <!-- Load theme.js in <head> so theme is applied before paint (prevents flash) -->
    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
    {% block head %}{% endblock %}
</head>
<body>
    <nav class="navbar">
        <a class="nav-brand" href="{{ url_for('dashboard.index') }}">
            PGSM
        </a>
        <ul class="nav-links">
            <li><a href="{{ url_for('dashboard.index') }}">Dashboard</a></li>
            <li><a href="{{ url_for('servers.list_servers') }}">Servers</a></li>
            <li><a href="{{ url_for('servers.create_server') }}" class="btn btn-primary btn-sm">+ New Server</a></li>
        </ul>
        <div class="theme-switcher">
            <button class="theme-toggle-btn" onclick="toggleThemeMenu()" title="Switch theme" aria-label="Switch theme">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="3"/><path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
                Theme
            </button>
            <div class="theme-menu" id="theme-menu" role="menu">
                <button class="theme-menu-item" data-theme="default" onclick="setTheme('default')" role="menuitem">
                    <span class="theme-swatch" style="background:#4f8ef7"></span>
                    PGSM Dark
                </button>
                <button class="theme-menu-item" data-theme="light" onclick="setTheme('light')" role="menuitem">
                    <span class="theme-swatch" style="background:#0969da;border-color:rgba(0,0,0,0.15)"></span>
                    Light
                </button>
                <button class="theme-menu-item" data-theme="nord" onclick="setTheme('nord')" role="menuitem">
                    <span class="theme-swatch" style="background:#88c0d0"></span>
                    Nord
                </button>
                <button class="theme-menu-item" data-theme="catppuccin-mocha" onclick="setTheme('catppuccin-mocha')" role="menuitem">
                    <span class="theme-swatch" style="background:#cba6f7"></span>
                    Catppuccin
                </button>
                <button class="theme-menu-item" data-theme="gruvbox" onclick="setTheme('gruvbox')" role="menuitem">
                    <span class="theme-swatch" style="background:#d79921"></span>
                    Gruvbox
                </button>
                <button class="theme-menu-item" data-theme="discord" onclick="setTheme('discord')" role="menuitem">
                    <span class="theme-swatch" style="background:#5865f2"></span>
                    Discord
                </button>
                <button class="theme-menu-item" data-theme="midnight-purple" onclick="setTheme('midnight-purple')" role="menuitem">
                    <span class="theme-swatch" style="background:#a855f7"></span>
                    Midnight Purple
                </button>
                <button class="theme-menu-item" data-theme="high-contrast" onclick="setTheme('high-contrast')" role="menuitem">
                    <span class="theme-swatch" style="background:#ffff00;border-color:rgba(255,255,255,0.3)"></span>
                    High Contrast
                </button>
                <button class="theme-menu-item" data-theme="dracula" onclick="setTheme('dracula')" role="menuitem">
                    <span class="theme-swatch" style="background:#bd93f9"></span>
                    Dracula
                </button>
                <button class="theme-menu-item" data-theme="tokyo-night" onclick="setTheme('tokyo-night')" role="menuitem">
                    <span class="theme-swatch" style="background:#7aa2f7"></span>
                    Tokyo Night
                </button>
            </div>
        </div>
    </nav>

    <main class="main-content">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-container">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">
                            <span>{{ message }}</span>
                            <button class="alert-close" onclick="this.parentElement.remove()" aria-label="Dismiss">&times;</button>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    {% block scripts %}{% endblock %}
</body>
</html>
